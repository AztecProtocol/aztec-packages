#!/usr/bin/env bash
set -eux
# Launches tmux with 1 window that has as many panes as lines of input
session_name=$1

# Kill any existing tmux session with the same name
tmux kill-session -t "$session_name" || true

# Start a new tmux session
tmux new-session -d -s "$session_name"

# Read commands from stdin into an array
commands=()
while IFS= read -r command; do
  commands+=("$command")
done

# Create the necessary number of panes
num_commands=${#commands[@]}
for ((i=1; i<num_commands; i++)); do
  # Split the first pane each time
  tmux split-window -t "$session_name:0.0" -h
  tmux select-layout -t "$session_name:0" tiled
done

# Now send commands to each pane
for ((i=0; i<num_commands; i++)); do
  tmux send-keys -t "$session_name:0.$i" "${commands[$i]}" C-m
done

echo "Commands have been queued in tmux session '${session_name}'."
echo "You can attach to this session with 'tmux attach-session -t ${session_name}' from a terminal."
echo "To detach, use backtick (`) (or your prefix) then d"
